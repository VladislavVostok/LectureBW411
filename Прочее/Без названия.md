C–µ–π—á–∞—Å —Å–µ—Ä–≤–µ—Ä —Ö–æ—Ç—å –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç –æ—Ç–¥–µ–ª—å–Ω—ã–µ –ø–æ—Ç–æ–∫–∏ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤, –Ω–æ —Ç—ã **join‚Äô–∏—à—å** —ç—Ç–∏ –ø–æ—Ç–æ–∫–∏ —Å—Ä–∞–∑—É –≤ –≥–ª–∞–≤–Ω–æ–º —Ü–∏–∫–ª–µ, —á—Ç–æ –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫—É —Å–Ω–æ–≤–∞ –≤ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é (–≥–ª–∞–≤–Ω—ã–π –ø–æ—Ç–æ–∫ –∂–¥—ë—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∫–∞–∂–¥–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞).

–í–æ—Ç –ø—Ä–æ–±–ª–µ–º–Ω–æ–µ –º–µ—Å—Ç–æ:

```cpp
clientThreads.emplace_back([clientSocket]() { handleClient(clientSocket); });

clientThreads.erase(
    std::remove_if(clientThreads.begin(), clientThreads.end(), [](std::thread& t) {
        if (t.joinable()) {
            t.join();
            return true;
        }
        return false;
    }),
    clientThreads.end()
);
```
–¢—ã –∑–∞–ø—É—Å–∫–∞–µ—à—å –ø–æ—Ç–æ–∫ ‚Üí **—Å—Ä–∞–∑—É** –∂–¥—ë—à—å –µ–≥–æ –æ–∫–æ–Ω—á–∞–Ω–∏—è ‚Üí —É–¥–∞–ª—è–µ—à—å.  
–í –∏—Ç–æ–≥–µ —Å–ª–µ–¥—É—é—â–∏–π –∫–ª–∏–µ–Ω—Ç –Ω–µ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç—Å—è, –ø–æ–∫–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏–π –ø–æ—Ç–æ–∫ –Ω–µ –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è.

### –ö–∞–∫ –∏—Å–ø—Ä–∞–≤–∏—Ç—å, —á—Ç–æ–±—ã –ø–æ—Ç–æ–∫–∏ —Ä–∞–±–æ—Ç–∞–ª–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ

–í—ã–Ω–µ—Å–∏ join-—ã **–∑–∞ –ø—Ä–µ–¥–µ–ª—ã –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ accept** ‚Äî –ø—É—Å—Ç—å main –ø—Ä–æ—Å—Ç–æ —Å–æ–±–∏—Ä–∞–µ—Ç –ø–æ—Ç–æ–∫–∏ –≤ `clientThreads`, –∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–æ–≤ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ.

–í–æ—Ç —Ä–∞–±–æ—á–µ–µ —Ä–µ—à–µ–Ω–∏–µ:


```cpp
while (serverRuning) {
    sockaddr_in clientAddr;
    socklen_t clientAddrLen = sizeof(clientAddr);
    int clientSocket = accept(serverSocket, (sockaddr*)&clientAddr, &clientAddrLen);

    if (clientSocket == INVALID_SOCKET) {
        cerr << "–û—à–∏–±–∫–∞ –ø—Ä–∏–Ω—è—Ç–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è" << endl;
        continue;
    }

    char clientIP[INET_ADDRSTRLEN];
    inet_ntop(AF_INET, &clientAddr.sin_addr, clientIP, INET_ADDRSTRLEN);
    cout << "New connect from " << clientIP << ":" << ntohs(clientAddr.sin_port) << endl;

    clientThreads.emplace_back([clientSocket]() { handleClient(clientSocket); });
}

// –ü–æ—Å–ª–µ –≤—ã—Ö–æ–¥–∞ –∏–∑ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Ü–∏–∫–ª–∞, –¥–æ–∂–∏–¥–∞–µ–º—Å—è –≤—Å–µ—Ö –ø–æ—Ç–æ–∫–æ–≤
for (auto& thread : clientThreads) {
    if (thread.joinable()) {
        thread.join();
    }
}

```


**–ß—Ç–æ –ø–æ–º–µ–Ω—è–ª–æ—Å—å:**

1. –£–±—Ä–∞–ª–∏ `erase/remove_if` –∏–∑ —Ü–∏–∫–ª–∞ ‚Üí `main` –Ω–µ –∂–¥—ë—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤.
    
2. –ü–æ—Ç–æ–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ.
    
3. –ü–æ—Å–ª–µ –≤—ã—Ö–æ–¥–∞ –∏–∑ —Ü–∏–∫–ª–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∏ `serverRuning = false`), –¥–æ–∂–∏–¥–∞–µ–º—Å—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Å–µ—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤.

### –ü–æ–ª–Ω—ã–π –ø—Ä–∏–º–µ—Ä —Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º –Ω–∞ thread


```cpp
while (serverRuning) {
    sockaddr_in clientAddr;
    socklen_t clientAddrLen = sizeof(clientAddr);
    int clientSocket = accept(serverSocket, (sockaddr*)&clientAddr, &clientAddrLen);

    if (clientSocket == INVALID_SOCKET) {
        cerr << "–û—à–∏–±–∫–∞ –ø—Ä–∏–Ω—è—Ç–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è" << endl;
        continue;
    }

    char clientIP[INET_ADDRSTRLEN];
    inet_ntop(AF_INET, &clientAddr.sin_addr, clientIP, INET_ADDRSTRLEN);
    cout << "New connect from " << clientIP << ":" << ntohs(clientAddr.sin_port) << endl;

    clientThreads.emplace_back([clientSocket]() { handleClient(clientSocket); });
}

// –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–∞
for (auto& thread : clientThreads) {
    if (thread.joinable()) {
        thread.join();
    }
}

```


### –ï—â—ë –æ–¥–Ω–æ —É–ª—É—á—à–µ–Ω–∏–µ (–∫–æ–º–∞–Ω–¥–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞)

–¢—ã —É–ø–æ–º—è–Ω—É–ª:


–í `processRequest` –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å:

```cpp
if (request == "QUIT") {
    return "OK|Disconnect";
}

```

–ê –≤ `handleClient` –ø—Ä–æ–≤–µ—Ä—è—Ç—å:

```cpp
if (request == "QUIT") {
    cout << "–ö–ª–∏–µ–Ω—Ç –æ—Ç–∫–ª—é—á–∏–ª—Å—è –ø–æ –∑–∞–ø—Ä–æ—Å—É" << endl;
    break;
}

```

## –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –∑–∞–≥–æ–ª–æ–≤–æ—á–Ω—ã–π —Ñ–∞–π–ª (product.h)


```cpp
#ifndef PRODUCT_H
#define PRODUCT_H

#include <string>
#include <stdexcept>

struct Product {
    int id;
    std::string name;
    double price;
    int quantity;
    std::string category;
    
    std::string to_string() const {
        return std::to_string(id) + "|" + name + "|" + 
               std::to_string(price) + "|" + 
               std::to_string(quantity) + "|" + 
               category;
    }
    
    static Product from_string(const std::string& str) {
        Product p;
        size_t pos1 = str.find('|');
        if (pos1 == std::string::npos) throw std::invalid_argument("–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–∞");
        
        size_t pos2 = str.find('|', pos1 + 1);
        if (pos2 == std::string::npos) throw std::invalid_argument("–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–∞");
        
        size_t pos3 = str.find('|', pos2 + 1);
        if (pos3 == std::string::npos) throw std::invalid_argument("–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–∞");
        
        size_t pos4 = str.find('|', pos3 + 1);
        if (pos4 == std::string::npos) throw std::invalid_argument("–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–∞");
        
        try {
            p.id = std::stoi(str.substr(0, pos1));
            p.name = str.substr(pos1 + 1, pos2 - pos1 - 1);
            p.price = std::stod(str.substr(pos2 + 1, pos3 - pos2 - 1));
            p.quantity = std::stoi(str.substr(pos3 + 1, pos4 - pos3 - 1));
            p.category = str.substr(pos4 + 1);
        } catch (...) {
            throw std::invalid_argument("–û—à–∏–±–∫–∞ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–∞");
        }
        
        return p;
    }
    
    // –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–∞
    void validate() const {
        if (id <= 0) throw std::invalid_argument("ID —Ç–æ–≤–∞—Ä–∞ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º");
        if (name.empty()) throw std::invalid_argument("–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º");
        if (price <= 0) throw std::invalid_argument("–¶–µ–Ω–∞ —Ç–æ–≤–∞—Ä–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–π");
        if (quantity < 0) throw std::invalid_argument("–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º");
        if (category.empty()) throw std::invalid_argument("–ö–∞—Ç–µ–≥–æ—Ä–∏—è —Ç–æ–≤–∞—Ä–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç–æ–π");
    }
};

#endif // PRODUCT_H
```


## –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —Å–µ—Ä–≤–µ—Ä (server.cpp)

```cpp
#include "cross_platform_sockets.h"
#include "product.h"
#include <vector>
#include <sstream>
#include <algorithm>
#include <memory>

// –ì–ª–æ–±–∞–ª—å–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
std::map<int, Product> productDatabase = {
    {1, {1, "–ù–æ—É—Ç–±—É–∫ Lenovo IdeaPad", 54999.99, 12, "–ù–æ—É—Ç–±—É–∫–∏"}},
    {2, {2, "–°–º–∞—Ä—Ç—Ñ–æ–Ω Xiaomi Redmi Note", 24999.50, 34, "–°–º–∞—Ä—Ç—Ñ–æ–Ω—ã"}},
    {3, {3, "–ù–∞—É—à–Ω–∏–∫–∏ Sony WH-1000XM4", 19999.99, 8, "–ê–∫—Å–µ—Å—Å—É–∞—Ä—ã"}},
    {4, {4, "–ü–ª–∞–Ω—à–µ—Ç Samsung Galaxy Tab", 32999.00, 15, "–ü–ª–∞–Ω—à–µ—Ç—ã"}},
    {5, {5, "–ú–æ–Ω–∏—Ç–æ—Ä LG 27GL850", 42999.95, 7, "–ú–æ–Ω–∏—Ç–æ—Ä—ã"}}
};

std::mutex dbMutex;
std::atomic<bool> serverRunning(true);

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –Ω–æ–≤–æ–≥–æ ID —Ç–æ–≤–∞—Ä–∞
int generateProductId() {
    std::lock_guard<std::mutex> lock(dbMutex);
    if (productDatabase.empty()) return 1;
    return productDatabase.rbegin()->first + 1;
}

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥ CRUD
std::string processRequest(const std::string& request) {
    // –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –≤—Å–µ—Ö —Ç–æ–≤–∞—Ä–æ–≤
    if (request == "LIST_ALL") {
        std::lock_guard<std::mutex> lock(dbMutex);
        if (productDatabase.empty()) {
            return "ERROR|–í –±–∞–∑–µ –Ω–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤";
        }
        
        std::string response;
        for (const auto& [id, product] : productDatabase) {
            response += product.to_string() + "\n";
        }
        return response;
    }
    // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –ø–æ ID
    else if (request.rfind("GET ", 0) == 0) {
        int productId;
        try {
            productId = std::stoi(request.substr(4));
        } catch (...) {
            return "ERROR|–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç ID —Ç–æ–≤–∞—Ä–∞";
        }
        
        std::lock_guard<std::mutex> lock(dbMutex);
        auto it = productDatabase.find(productId);
        if (it == productDatabase.end()) {
            return "ERROR|–¢–æ–≤–∞—Ä —Å ID " + std::to_string(productId) + " –Ω–µ –Ω–∞–π–¥–µ–Ω";
        }
        
        return "OK|" + it->second.to_string();
    }
    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ç–æ–≤–∞—Ä–∞
    else if (request.rfind("ADD ", 0) == 0) {
        try {
            Product p = Product::from_string(request.substr(4));
            p.validate();
            
            std::lock_guard<std::mutex> lock(dbMutex);
            if (productDatabase.count(p.id)) {
                return "ERROR|–¢–æ–≤–∞—Ä —Å ID " + std::to_string(p.id) + " —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç";
            }
            
            productDatabase[p.id] = p;
            return "OK|–¢–æ–≤–∞—Ä —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω. ID: " + std::to_string(p.id);
        } catch (const std::exception& e) {
            return "ERROR|" + std::string(e.what());
        }
    }
    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ —Ç–æ–≤–∞—Ä–∞
    else if (request.rfind("UPDATE ", 0) == 0) {
        try {
            Product p = Product::from_string(request.substr(7));
            p.validate();
            
            std::lock_guard<std::mutex> lock(dbMutex);
            if (!productDatabase.count(p.id)) {
                return "ERROR|–¢–æ–≤–∞—Ä —Å ID " + std::to_string(p.id) + " –Ω–µ –Ω–∞–π–¥–µ–Ω";
            }
            
            productDatabase[p.id] = p;
            return "OK|–¢–æ–≤–∞—Ä —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω";
        } catch (const std::exception& e) {
            return "ERROR|" + std::string(e.what());
        }
    }
    // –£–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞
    else if (request.rfind("DELETE ", 0) == 0) {
        int productId;
        try {
            productId = std::stoi(request.substr(7));
        } catch (...) {
            return "ERROR|–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç ID —Ç–æ–≤–∞—Ä–∞";
        }
        
        std::lock_guard<std::mutex> lock(dbMutex);
        if (productDatabase.erase(productId)) {
            return "OK|–¢–æ–≤–∞—Ä —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω";
        } else {
            return "ERROR|–¢–æ–≤–∞—Ä —Å ID " + std::to_string(productId) + " –Ω–µ –Ω–∞–π–¥–µ–Ω";
        }
    }
    // –ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è ID –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏
    else if (request.rfind("ADD_AUTOID ", 0) == 0) {
        try {
            Product p = Product::from_string(request.substr(11));
            p.validate();
            
            std::lock_guard<std::mutex> lock(dbMutex);
            p.id = generateProductId();
            productDatabase[p.id] = p;
            return "OK|–¢–æ–≤–∞—Ä —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω. ID: " + std::to_string(p.id);
        } catch (const std::exception& e) {
            return "ERROR|" + std::string(e.what());
        }
    }
    
    return "ERROR|–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞";
}

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–µ–Ω—Ç–∞ (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
void handleClient(int clientSocket) {
    // ... (–ø—Ä–µ–∂–Ω–∏–π –∫–æ–¥ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ –∫–ª–∏–µ–Ω—Ç–∞)
}

int main() {
    // ... (–ø—Ä–µ–∂–Ω–∏–π –∫–æ–¥ main)
}
```


## –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –∫–ª–∏–µ–Ω—Ç (client.cpp)

```cpp
#include "cross_platform_sockets.h"
#include "product.h"
#include <iostream>
#include <vector>
#include <sstream>
#include <limits>

// ... (–ø—Ä–µ–∂–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ split –∏ printProduct)

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤–≤–æ–¥–∞ –¥–∞–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–∞ —Å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
Product inputProduct(bool requireId = true) {
    Product p;
    
    if (requireId) {
        std::cout << "–í–≤–µ–¥–∏—Ç–µ ID —Ç–æ–≤–∞—Ä–∞: ";
        std::cin >> p.id;
        std::cin.ignore();
    }
    
    std::cout << "–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞: ";
    std::getline(std::cin, p.name);
    
    std::cout << "–í–≤–µ–¥–∏—Ç–µ —Ü–µ–Ω—É —Ç–æ–≤–∞—Ä–∞: ";
    std::cin >> p.price;
    std::cin.ignore();
    
    std::cout << "–í–≤–µ–¥–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–∞: ";
    std::cin >> p.quantity;
    std::cin.ignore();
    
    std::cout << "–í–≤–µ–¥–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é —Ç–æ–≤–∞—Ä–∞: ";
    std::getline(std::cin, p.category);
    
    return p;
}

int main() {
    try {
        init_network();
        
        int sock = socket(AF_INET, SOCK_STREAM, 0);
        check_socket_error(sock, "–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Å–æ–∫–µ—Ç–∞");
        
        sockaddr_in servAddr;
        servAddr.sin_family = AF_INET;
        servAddr.sin_port = htons(5555);
        
        if (inet_pton(AF_INET, "127.0.0.1", &servAddr.sin_addr) <= 0) {
            throw std::runtime_error("–ù–µ–≤–µ—Ä–Ω—ã–π –∞–¥—Ä–µ—Å —Å–µ—Ä–≤–µ—Ä–∞");
        }
        
        check_socket_error(
            connect(sock, (sockaddr*)&servAddr, sizeof(servAddr)),
            "–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É"
        );
        
        std::cout << "–£—Å–ø–µ—à–Ω–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ —Å–µ—Ä–≤–µ—Ä—É" << std::endl;
        
        while (true) {
            std::cout << "\n–ú–µ–Ω—é:\n";
            std::cout << "1. –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ç–æ–≤–∞—Ä–æ–≤\n";
            std::cout << "2. –ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–æ–≤–∞—Ä–µ –ø–æ ID\n";
            std::cout << "3. –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Ç–æ–≤–∞—Ä (—Å —É–∫–∞–∑–∞–Ω–∏–µ–º ID)\n";
            std::cout << "4. –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Ç–æ–≤–∞—Ä (–∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è ID)\n";
            std::cout << "5. –û–±–Ω–æ–≤–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Ç–æ–≤–∞—Ä\n";
            std::cout << "6. –£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä\n";
            std::cout << "7. –í—ã—Ö–æ–¥\n";
            std::cout << "–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ: ";
            
            int choice;
            std::cin >> choice;
            std::cin.ignore();
            
            std::string request;
            try {
                if (choice == 1) {
                    request = "LIST_ALL";
                } else if (choice == 2) {
                    std::cout << "–í–≤–µ–¥–∏—Ç–µ ID —Ç–æ–≤–∞—Ä–∞: ";
                    int id;
                    std::cin >> id;
                    std::cin.ignore();
                    request = "GET " + std::to_string(id);
                } else if (choice == 3) {
                    Product p = inputProduct(true);
                    request = "ADD " + p.to_string();
                } else if (choice == 4) {
                    Product p = inputProduct(false);
                    request = "ADD_AUTOID " + p.to_string();
                } else if (choice == 5) {
                    Product p = inputProduct(true);
                    request = "UPDATE " + p.to_string();
                } else if (choice == 6) {
                    std::cout << "–í–≤–µ–¥–∏—Ç–µ ID —Ç–æ–≤–∞—Ä–∞ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è: ";
                    int id;
                    std::cin >> id;
                    std::cin.ignore();
                    request = "DELETE " + std::to_string(id);
                } else if (choice == 7) {
                    break;
                } else {
                    std::cout << "–ù–µ–≤–µ—Ä–Ω—ã–π –≤—ã–±–æ—Ä!\n";
                    continue;
                }
            } catch (const std::exception& e) {
                std::cerr << "–û—à–∏–±–∫–∞ –≤–≤–æ–¥–∞: " << e.what() << "\n";
                continue;
            }
            
            // –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞
            int bytesSent = send(sock, request.c_str(), request.size(), MSG_NOSIGNAL);
            check_socket_error(bytesSent, "–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–ø—Ä–æ—Å–∞");
            
            char buffer[1024] = {0};
            int bytesRead = recv(sock, buffer, sizeof(buffer), 0);
            check_socket_error(bytesRead, "–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –æ—Ç–≤–µ—Ç–∞");
            
            if (bytesRead <= 0) {
                throw std::runtime_error("–°–µ—Ä–≤–µ—Ä –∑–∞–∫—Ä—ã–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ");
            }
            
            std::string response(buffer, bytesRead);
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–∞
            if (response.rfind("ERROR|", 0) == 0) {
                std::cerr << "–û—à–∏–±–∫–∞: " << response.substr(6) << "\n";
            } else if (response.rfind("OK|", 0) == 0) {
                std::cout << "–£—Å–ø–µ—Ö: " << response.substr(3) << "\n";
                
                // –ï—Å–ª–∏ —ç—Ç–æ –∑–∞–ø—Ä–æ—Å —Ç–æ–≤–∞—Ä–∞ - –≤—ã–≤–æ–¥–∏–º –µ–≥–æ –¥–∞–Ω–Ω—ã–µ
                if (request.rfind("GET ", 0) == 0) {
                    Product p = Product::from_string(response.substr(3));
                    printProduct(p);
                }
            } else {
                // –í—ã–≤–æ–¥ —Å–ø–∏—Å–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤
                std::vector<std::string> products = split(response, '\n');
                for (const auto& productStr : products) {
                    if (!productStr.empty()) {
                        Product p = Product::from_string(productStr);
                        printProduct(p);
                        std::cout << "----------------\n";
                    }
                }
            }
        }
        
        close_socket(sock);
        cleanup_network();
    } catch (const std::exception& e) {
        std::cerr << "–û—à–∏–±–∫–∞: " << e.what() << std::endl;
        cleanup_network();
        return 1;
    }
    
    return 0;
}
```





–û—Ç–ª–∏—á–Ω—ã–π –≤–æ–ø—Ä–æ—Å ‚Äî —ç—Ç–æ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –ª–æ–≤—É—à–∫–∞, —Å –∫–æ—Ç–æ—Ä–æ–π –º–Ω–æ–≥–∏–µ —Å—Ç–∞–ª–∫–∏–≤–∞—é—Ç—Å—è, –∏ —è –æ–±—ä—è—Å–Ω—é, —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç.

–ö–æ–≥–¥–∞ —Ç—ã –ø–æ–¥–∫–ª—é—á–∞–µ—à—å:

cpp

–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å

`#include <future>`

–≤ —Ç–≤–æ–π –ø—Ä–æ–µ–∫—Ç, —ç—Ç–æ —Å–∞–º–æ –ø–æ —Å–µ–±–µ **–Ω–µ –ª–æ–º–∞–µ—Ç** `bind()`. –ü—Ä–æ–±–ª–µ–º–∞ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –∏–∑-–∑–∞ **–∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞ –∏–º—ë–Ω**.

–î–µ–ª–æ –≤–æ—Ç –≤ —á—ë–º:

---

### üí• –ü–æ—á–µ–º—É –ª–æ–º–∞–µ—Ç—Å—è `bind`

–í C++ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ (`<functional>`) –≤–Ω—É—Ç—Ä–∏ `<future>` –ø–æ–¥–∫–ª—é—á–∞–µ—Ç **std::bind** ‚Äî —Ñ—É–Ω–∫—Ü–∏—é-–æ–±—ë—Ä—Ç–∫—É –¥–ª—è —Å–≤—è–∑—ã–≤–∞–Ω–∏—è –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ —Å —Ñ—É–Ω–∫—Ü–∏—è–º–∏/–º–µ—Ç–æ–¥–∞–º–∏.

–ê –≤ —Å–æ–∫–µ—Ç–∞—Ö —É —Ç–µ–±—è –µ—Å—Ç—å **bind()** –∏–∑ `<sys/socket.h>` (Linux) –∏–ª–∏ `<winsock2.h>` (Windows), –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–∏–≤—è–∑—ã–≤–∞–µ—Ç —Å–æ–∫–µ—Ç –∫ –∞–¥—Ä–µ—Å—É:

cpp

–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å

`int bind(int sockfd, const struct sockaddr *addr, socklen_t addrlen);`

–ö–æ–≥–¥–∞ —Ç—ã –ø–∏—à–µ—à—å –∫–æ–¥ –≤—Ä–æ–¥–µ:

cpp

–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å

`bind(serverSocket, (sockaddr*)&serverAddr, sizeof(serverAddr));`

–∏ —É —Ç–µ–±—è –ø–æ–¥–∫–ª—é—á–µ–Ω `<future>`, –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä **–≤–∏–¥–∏—Ç –¥–≤–∞ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞**:

- `::bind` (–≥–ª–æ–±–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∏–∑ —Å–æ–∫–µ—Ç–æ–≤)
    
- `std::bind` (—à–∞–±–ª–æ–Ω –∏–∑ `<functional>`)
    

–ò –≤–æ—Ç —Ç—É—Ç –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è **–Ω–µ–æ–¥–Ω–æ–∑–Ω–∞—á–Ω–æ—Å—Ç—å**, –æ—Å–æ–±–µ–Ω–Ω–æ –µ—Å–ª–∏ —Ç—ã –ø–∏—à–µ—à—å `using namespace std;` (—á—Ç–æ –≤ —Ç–≤–æ—ë–º –∫–æ–¥–µ –µ—Å—Ç—å).



### üí° –ö–∞–∫ –∏—Å–ø—Ä–∞–≤–∏—Ç—å

–ï—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–ø–æ—Å–æ–±–æ–≤ ‚Äî –≤—ã–±–∏—Ä–∞–π –ø–æ –≤–∫—É—Å—É.


**–°–ø–æ—Å–æ–± 1. –£–±—Ä–∞—Ç—å `using namespace std;`**  
–õ—É—á—à–µ–µ —Ä–µ—à–µ–Ω–∏–µ:

cpp

–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å

`// –£–ë–†–ê–¢–¨: using namespace std;`

–í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ —è–≤–Ω–æ –ø–∏—à–∏:

cpp

–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å

`std::string, std::vector, std::map, std::lock_guard, std::thread, std::atomic`

–ò —Ç–æ–≥–¥–∞ `bind()` –±—É–¥–µ—Ç –≤—Å–µ–≥–¥–∞ –æ–¥–Ω–æ–∑–Ω–∞—á–Ω—ã–º ‚Äî –≤—ã–∑–æ–≤–µ—Ç—Å—è –≥–ª–æ–±–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è –∏–∑ —Å–æ–∫–µ—Ç–æ–≤.



```cpp
#include "cross_platform_sockets.h"
#include "product.h"
#include <iostream>
#include <string>
#include <map>
#include <mutex>
#include <atomic>
#include <vector>
#include <thread>
#include <future>

std::mutex dbMutex;
std::atomic<bool> serverRunning(true);

std::map<int, Product> productDatabase = {
    {1, {1, "–ù–æ—É—Ç–±—É–∫ Lenovo IdeaPad", 54999.99, 12, "–ù–æ—É—Ç–±—É–∫–∏"}},
    {2, {2, "–°–º–∞—Ä—Ñ–æ–Ω Xiaomi Redmi Note", 24999.50, 34, "–°–º–∞—Ä—Ç—Ñ–æ–Ω—ã"}},
    {3, {3, "–ù–∞—É—à–Ω–∏–∫–∏", 19999.99, 8, "–ê–∫—Å–µ—Å—Å—É–∞—Ä—ã"}},
    {4, {4, "–ú–æ–Ω–∏—Ç–æ—Ä LG 328y547", 42999.95, 7, "–ú–æ–Ω–∏—Ç–æ—Ä—ã"}}
};

std::string processRequest(const std::string& request) {
    if (request == "LIST_ALL") {
        std::lock_guard<std::mutex> lock(dbMutex);

        if (productDatabase.empty()) {
            return "ERROR|DB is empty";
        }

        std::string response;
        for (const auto& [id, product] : productDatabase) {
            response += product.to_string_custom() + "\n";
        }
        return response;
    }
    else if (request.rfind("GET ", 0) == 0) {
        if (productDatabase.empty()) {
            return "ERROR|DB is empty";
        }

        int productId;
        try {
            productId = std::stoi(request.substr(4));
        }
        catch (...) {
            return "ERROR|–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç ID —Ç–æ–≤–∞—Ä–∞";
        }

        std::lock_guard<std::mutex> lock(dbMutex);
        auto it = productDatabase.find(productId);
        if (it == productDatabase.end()) {
            return "ERROR|–¢–æ–≤–∞—Ä —Å ID " + std::to_string(productId) + " –Ω–µ –Ω–∞–π–¥–µ–Ω";
        }

        return "OK|" + it->second.to_string_custom();
    }
    else if (request == "QUIT") {
        return "OK|Disconnect";
    }

    return "ERROR|–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞";
}

void handleClient(int clientSocket) {
    try {
        char buffer[1024] = {0};

        while (true) {
            int bytesRead = recv(clientSocket, buffer, sizeof(buffer), 0);
            check_socket_error(bytesRead, "–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö");

            if (bytesRead <= 0) {
                break;
            }

            std::string request(buffer, bytesRead);
            std::cout << "–ó–∞–ø—Ä–æ—Å –ø–æ–ª—É—á–µ–Ω: " << request << std::endl;

            std::string response = processRequest(request);

            int byteSent = send(clientSocket, response.c_str(), response.size(), MSG_NOSIGNAL);
            check_socket_error(byteSent, "–î–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç—É –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã.");

            std::cout << "–û—Ç–ø—Ä–∞–≤–ª–µ–Ω –æ—Ç–≤–µ—Ç: " << response.size() << " –±–∞–π—Ç" << std::endl;

            if (request == "QUIT") {
                std::cout << "–ö–ª–∏–µ–Ω—Ç –∑–∞–ø—Ä–æ—Å–∏–ª –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ." << std::endl;
                break;
            }
        }
    }
    catch (const std::exception& e) {
        std::cerr << "–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏: " << e.what() << std::endl;
    }

    close_socket(clientSocket);
}

int main() {
    setlocale(LC_ALL, "");
    std::vector<std::future<void>> clientFutures;

    try {
        init_network();

        int serverSocket = socket(AF_INET, SOCK_STREAM, 0);
        check_socket_error(serverSocket, "Creatin socket error!");

        sockaddr_in serverAddr;
        serverAddr.sin_family = AF_INET;
        serverAddr.sin_addr.s_addr = INADDR_ANY;
        serverAddr.sin_port = htons(5555);

        int opt = 1;
    #ifdef _WIN32
        check_socket_error(setsockopt(serverSocket, SOL_SOCKET, SO_REUSEADDR, (const char*)&opt, sizeof(opt)), "Installing error SO_REUSEDADDR");
    #else
        check_socket_error(setsockopt(serverSocket, SOL_SOCKET, SO_REUSEADDR, &opt, sizeof(opt)), "Installing error SO_REUSEDADDR");
    #endif

        check_socket_error(::bind(serverSocket, (sockaddr*)&serverAddr, sizeof(serverAddr)), "bindin socket error!");
        check_socket_error(listen(serverSocket, 10), "listening socket error!");

        std::cout << "Server started on port 5555" << std::endl;

        while (serverRunning) {
            sockaddr_in clientAddr;
            socklen_t clientAddrLen = sizeof(clientAddr);
            int clientSocket = accept(serverSocket, (sockaddr*)&clientAddr, &clientAddrLen);

            if (clientSocket == INVALID_SOCKET) {
                std::cerr << "–û—à–∏–±–∫–∞ –ø—Ä–∏–Ω—è—Ç–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è" << std::endl;
                continue;
            }

            char clientIP[INET_ADDRSTRLEN];
            inet_ntop(AF_INET, &clientAddr.sin_addr, clientIP, INET_ADDRSTRLEN);
            std::cout << "New connection from " << clientIP << ":" << ntohs(clientAddr.sin_port) << std::endl;

            clientFutures.emplace_back(
                std::async(std::launch::async, [clientSocket]() {
                    handleClient(clientSocket);
                })
            );
        }

        close_socket(serverSocket);
        cleanup_network();
    }
    catch (const std::exception& e) {
        std::cerr << "Critical error: " << e.what() << std::endl;
        cleanup_network();
        return 1;
    }

    return 0;
}
```



### –ü–æ–ª–Ω—ã–π –ø—Ä–∏–º–µ—Ä –≤—Å—Ç–∞–≤–∫–∏ + –æ—á–∏—Å—Ç–∫–∏


```cpp
clientFutures.emplace_back(std::async(std::launch::async, [clientSocket]() {
    handleClient(clientSocket);
}));

// –ß–∏—Å—Ç–∏–º –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ
clientFutures.erase(
    std::remove_if(clientFutures.begin(), clientFutures.end(),
        [](std::future<void>& f) {
            return f.wait_for(std::chrono::seconds(0)) == std::future_status::ready;
        }),
    clientFutures.end()
);

```



–û—Ç–ª–∏—á–Ω–æ, –≤–æ—Ç –ø—Ä–∏–º–µ—Ä Makefile –¥–ª—è —Å–±–æ—Ä–∫–∏ **—Ç–≤–æ–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞** —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `cross_platform_sockets.h` –∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º DLL –∏–ª–∏ SO (–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏).  
–Ø –ø–æ–¥–≥–æ—Ç–æ–≤–ª—é –µ–≥–æ –¥–ª—è **Windows (MinGW)** –∏ **Linux (g++)**, —á—Ç–æ–±—ã —Ç—ã –º–æ–≥ –ø—Ä–æ—Å—Ç–æ –∑–∞–ø—É—Å–∫–∞—Ç—å `make` –∏ —Å–æ–±–∏—Ä–∞—Ç—å.

---

### üìÑ Makefile –¥–ª—è —Å–µ—Ä–≤–µ—Ä–∞

```makefile
# –ù–∞–∑–≤–∞–Ω–∏–µ –≤—ã—Ö–æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
TARGET = server

# –ò—Å—Ö–æ–¥–Ω–∏–∫–∏
SRC = main.cpp

# –î–ª—è Linux –∏ Windows
ifeq ($(OS),Windows_NT)
    CC = g++
    CFLAGS = -Wall -std=c++17
    LDFLAGS = -lws2_32
    OUTFILE = $(TARGET).exe
else
    CC = g++
    CFLAGS = -Wall -std=c++17
    LDFLAGS =
    OUTFILE = $(TARGET)
endif

all: $(OUTFILE)

$(OUTFILE): $(SRC)
	$(CC) $(CFLAGS) -o $(OUTFILE) $(SRC) $(LDFLAGS)

clean:
	rm -f $(OUTFILE)

```

---

### üì¶ –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

1. –ü–æ–ª–æ–∂–∏ —ç—Ç–æ—Ç Makefile –≤ –ø–∞–ø–∫—É —Å —Å–µ—Ä–≤–µ—Ä–æ–º.
    
2. –ù–∞–∑–æ–≤–∏ —Å–≤–æ–π —Ñ–∞–π–ª, –Ω–∞–ø—Ä–∏–º–µ—Ä, `main.cpp`.
    
3. –í—ã–ø–æ–ª–Ω–∏:
    

bash

–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å

`make`

–ù–∞ Windows –ø–æ–ª—É—á–∏—Ç—Å—è:

pgsql

–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å

`server.exe`

–ù–∞ Linux:

nginx

–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å

`server`




–ö–æ–Ω–µ—á–Ω–æ! –í–æ—Ç –ø–æ–¥—Ä–æ–±–Ω–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ —Ç–≤–æ–µ–≥–æ Makefile ‚Äî –ø–æ—Å—Ç—Ä–æ—á–Ω–æ:

---

makefile

–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å

`# –ù–∞–∑–≤–∞–Ω–∏–µ –≤—ã—Ö–æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ TARGET = server`

üëâ –ó–∞–¥–∞—ë–º –∏–º—è –∏—Å–ø–æ–ª–Ω—è–µ–º–æ–≥–æ —Ñ–∞–π–ª–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `server.exe` –∏–ª–∏ `server`).  
–ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è `TARGET` = `server`.  
–î–∞–ª—å—à–µ –µ—ë –ø–æ–¥—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ –æ—Å–Ω–æ–≤—É –∏–º–µ–Ω–∏.

---

makefile

–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å

`# –ò—Å—Ö–æ–¥–Ω–∏–∫–∏ SRC = main.cpp`

üëâ –£–∫–∞–∑—ã–≤–∞–µ–º –≥–ª–∞–≤–Ω—ã–π –∏—Å—Ö–æ–¥–Ω—ã–π —Ñ–∞–π–ª –ø—Ä–æ–≥—Ä–∞–º–º—ã.  
–í —Ç–≤–æ—ë–º —Å–ª—É—á–∞–µ ‚Äî `main.cpp`.

---

makefile

–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å

`# –î–ª—è Linux –∏ Windows ifeq ($(OS),Windows_NT)`

üëâ –ü—Ä–æ–≤–µ—Ä—è–µ–º, **–Ω–∞ –∫–∞–∫–æ–π –û–°** –∑–∞–ø—É—Å–∫–∞–µ–º Makefile.  
`$(OS)` ‚Äî —Å–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è GNU Make.  
–ï—Å–ª–∏ —ç—Ç–æ Windows, —Ç–æ `$(OS)` –±—É–¥–µ—Ç `Windows_NT`.

---

makefile

–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å

    `CC = g++`

üëâ –ó–∞–¥–∞—ë–º –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä ‚Äî `g++` (GNU C++ compiler).  
–î–ª—è Windows.

---

makefile

–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å

    `CFLAGS = -Wall -std=c++17`

üëâ –û–ø—Ü–∏–∏ –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–∞:

- `-Wall` ‚Äî –≤–∫–ª—é—á–∞–µ–º –≤—Å–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è (warnings);
    
- `-std=c++17` ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç C++17.
    

---

makefile

–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å

    `LDFLAGS = -lws2_32`

üëâ –û–ø—Ü–∏–∏ **–∫–æ–º–ø–æ–Ω–æ–≤—â–∏–∫–∞** (linker flags):

- `-lws2_32` ‚Äî –ø–æ–¥–∫–ª—é—á–∞–µ–º Windows –±–∏–±–ª–∏–æ—Ç–µ–∫—É Winsock (`ws2_32.lib`), –∫–æ—Ç–æ—Ä–∞—è –Ω—É–∂–Ω–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Å–æ–∫–µ—Ç–∞–º–∏ –Ω–∞ Windows.
    

---

makefile

–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å

    `OUTFILE = $(TARGET).exe`

üëâ –ò–º—è –≤—ã—Ö–æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ –Ω–∞ Windows = `server.exe`.

---

makefile

–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å

`else`

üëâ –ï—Å–ª–∏ –Ω–µ Windows (—Ç–æ –µ—Å—Ç—å Linux / macOS), —Ç–æ‚Ä¶

---

makefile

–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å

    `CC = g++     CFLAGS = -Wall -std=c++17     LDFLAGS =     OUTFILE = $(TARGET)`

üëâ

- –ö–æ–º–ø–∏–ª—è—Ç–æ—Ä: `g++`;
    
- –û–ø—Ü–∏–∏: `-Wall -std=c++17`;
    
- Linker-—Ñ–ª–∞–≥–∏ –ø—É—Å—Ç—ã–µ (`LDFLAGS =`), –ø–æ—Ç–æ–º—É —á—Ç–æ Winsock –Ω–µ –Ω—É–∂–µ–Ω;
    
- –í—ã—Ö–æ–¥–Ω–æ–π —Ñ–∞–π–ª = `server` (–±–µ–∑ `.exe`).
    

---

makefile

–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å

`endif`

üëâ –ó–∞–∫–∞–Ω—á–∏–≤–∞–µ–º –±–ª–æ–∫ `ifeq`.

---

makefile

–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å

`all: $(OUTFILE)`

üëâ –≠—Ç–æ **—Ü–µ–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é** ‚Äî –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è, –µ—Å–ª–∏ –Ω–∞–ø–∏—Å–∞—Ç—å –ø—Ä–æ—Å—Ç–æ `make`.  
–û–Ω–∞ –æ–∑–Ω–∞—á–∞–µ—Ç: —á—Ç–æ–±—ã —Å–æ–±—Ä–∞—Ç—å `all`, –Ω—É–∂–Ω–æ —Å–æ–±—Ä–∞—Ç—å `$(OUTFILE)`.

---

makefile

–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å

`$(OUTFILE): $(SRC) 	$(CC) $(CFLAGS) -o $(OUTFILE) $(SRC) $(LDFLAGS)`

üëâ **–ö–∞–∫ —Å–æ–±—Ä–∞—Ç—å –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–π —Ñ–∞–π–ª**:

- —Å–∫–æ–º–ø–∏–ª–∏—Ä—É–π `main.cpp` ‚Üí `server` –∏–ª–∏ `server.exe`;
    
- –∏—Å–ø–æ–ª—å–∑—É–π –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä `$(CC)` —Å —Ñ–ª–∞–≥–∞–º–∏ `$(CFLAGS)`;
    
- –ø–æ–ª–æ–∂–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ —Ñ–∞–π–ª `$(OUTFILE)`;
    
- –ø–æ–¥–∫–ª—é—á–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ `$(LDFLAGS)`.
    

**–ü—Ä–∏–º–µ—Ä —Å–æ–±—Ä–∞–Ω–Ω–æ–π –∫–æ–º–∞–Ω–¥—ã –Ω–∞ Linux:**

r

–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å

`g++ -Wall -std=c++17 -o server main.cpp`

**–ü—Ä–∏–º–µ—Ä –Ω–∞ Windows:**

r

–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å

`g++ -Wall -std=c++17 -o server.exe main.cpp -lws2_32`

---

makefile

–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å

`clean: 	rm -f $(OUTFILE)`

üëâ –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–æ–º–∞–Ω–¥—É `make clean` ‚Äî –æ–Ω–∞ —É–¥–∞–ª—è–µ—Ç —Å–æ–±—Ä–∞–Ω–Ω—ã–π –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–π —Ñ–∞–π–ª.

- `rm -f` —É–¥–∞–ª—è–µ—Ç —Ñ–∞–π–ª –±–µ–∑ –æ—à–∏–±–∫–∏, –µ—Å–ª–∏ –æ–Ω –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç.
    

---

### üì¶ –ß—Ç–æ —Ç—ã –ø–æ–ª—É—á–∞–µ—à—å:

- `make` ‚Üí —Å–æ–±–µ—Ä—ë—Ç —Å–µ—Ä–≤–µ—Ä;
    
- `make clean` ‚Üí —É–¥–∞–ª–∏—Ç `server` –∏–ª–∏ `server.exe`.